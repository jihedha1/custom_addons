<?xml version="1.0" encoding="utf-8"?>
<odoo>

    <!-- ================================================================== -->
    <!-- WIZARD DE CORRECTION MANUELLE -->
    <!-- ================================================================== -->
    <record id="view_correction_wizard_form" model="ir.ui.view">
        <field name="name">slide.question.correction.wizard.form</field>
        <field name="model">slide.question.correction.wizard</field>
        <field name="arch" type="xml">
            <form string="Assistant de Correction">

                <!-- Champs cach√©s -->
                <field name="pending_answer_id" invisible="1"/>
                <field name="question_type" invisible="1"/>
                <field name="submission_date" invisible="1"/>
                <field name="suggested_score" invisible="1"/>
                <field name="score_difference" invisible="1"/>
                <field name="correction_quality" invisible="1"/>

                <sheet>

                    <!-- En-t√™te avec informations cl√©s -->
                    <div class="oe_title">
                        <h1>
                            <i class="fa fa-edit me-2"/>
                            Assistant de Correction Manuelle
                        </h1>
                    </div>

                    <!-- Informations contextuelles -->
                    <group>
                        <group string="üìö Contexte">
                            <label for="question_text" string="Question pos√©e"/>
                            <div class="o_row">
                                <field name="question_text" readonly="1"
                                       widget="text"
                                       nolabel="1"
                                       class="text-muted"/>
                            </div>
                        </group>
                    </group>

                    <group>
                        <group string="üë§ √âtudiant">
                            <field name="student_name" readonly="1"/>
                            <field name="student_email" readonly="1"
                                   widget="email"/>
                        </group>
                        <group string="üìä Suggestion Automatique">
                            <field name="suggested_score" readonly="1"
                                   widget="progressbar"/>
                            <label for="score_difference"/>
                            <div class="o_row">
                                <field name="score_difference" readonly="1"/>
                                <span class="text-muted ms-2"
                                      invisible="score_difference == 0">
                                    points de diff√©rence
                                </span>
                            </div>
                        </group>
                    </group>

                    <!-- Alertes -->
                    <div class="alert alert-warning" role="alert"
                         invisible="score_difference == 0 or score_difference &gt; -20 and score_difference &lt; 20">
                        <i class="fa fa-exclamation-triangle me-2" title="Attention" role="img" aria-label="Attention"></i>
                        <strong>Attention :</strong>
                        Vous vous appr√™tez √† modifier significativement le score sugg√©r√©
                        (
                        <field name="score_difference" readonly="1" nolabel="1"/>
                        points).
                    </div>

                    <!-- R√©ponse de l'√©tudiant -->
                    <separator string="üìù R√©ponse de l'√âtudiant"/>
                    <group>
                        <field name="student_answer" readonly="1"
                               widget="text"
                               nolabel="1"
                               class="o_field_text"
                               style="min-height: 120px; background-color: #f8f9fa; padding: 10px;"/>
                    </group>

                    <!-- R√©ponse id√©ale GPT (si disponible) -->
                    <group invisible="gpt_ideal_answer == False">
                        <separator string="ü§ñ R√©ponse Id√©ale (Sugg√©r√©e par IA)"/>
                        <field name="gpt_ideal_answer" readonly="1"
                               widget="text"
                               nolabel="1"
                               class="o_field_text text-muted"
                               style="min-height: 80px; background-color: #e7f3ff; padding: 10px;"/>
                    </group>

                    <!-- Feedback sugg√©r√© -->
                    <notebook>
                        <page string="üí° Feedback Sugg√©r√©" name="suggested">
                            <div class="alert alert-info mb-3" role="status">
                                <i class="fa fa-info-circle me-2"></i>
                                Ce feedback a √©t√© g√©n√©r√© automatiquement.
                                Vous pouvez le modifier ou le remplacer.
                            </div>

                            <field name="use_suggested_feedback"
                                   widget="boolean_toggle"
                                   string="Utiliser le feedback sugg√©r√©"/>

                            <field name="suggested_feedback" readonly="1"
                                   widget="html"
                                   nolabel="1"
                                   class="mt-3"/>
                        </page>

                        <page string="‚úèÔ∏è Votre Correction" name="correction">

                            <!-- Score final -->
                            <group>
                                <group string="Note Finale">
                                    <field name="final_score"
                                           widget="integer"
                                           class="o_field_highlight"
                                           style="font-size: 1.5em;"/>

                                    <!-- Indicateur visuel de qualit√© -->
                                    <div class="mt-2">
                                        <span class="badge bg-secondary">
                                            <field name="correction_quality" readonly="1"/>
                                        </span>
                                    </div>
                                </group>

                                <group>
                                    <!-- Boutons templates rapides -->
                                    <div class="o_form_label">Templates Rapides</div>
                                    <div>
                                        <button string="Excellent (95)"
                                                type="object"
                                                name="action_apply_template"
                                                context="{'template_key': 'excellent'}"
                                                class="btn-sm btn-success me-1"/>
                                        <button string="Bon (75)"
                                                type="object"
                                                name="action_apply_template"
                                                context="{'template_key': 'good'}"
                                                class="btn-sm btn-info me-1"/>
                                        <button string="Incomplet (50)"
                                                type="object"
                                                name="action_apply_template"
                                                context="{'template_key': 'incomplete'}"
                                                class="btn-sm btn-warning me-1"/>
                                        <button string="Incorrect (20)"
                                                type="object"
                                                name="action_apply_template"
                                                context="{'template_key': 'incorrect'}"
                                                class="btn-sm btn-danger"/>
                                    </div>
                                </group>
                            </group>

                            <!-- Feedback personnalis√© -->
                            <separator string="Feedback √† Envoyer √† l'√âtudiant"/>
                            <field name="final_feedback"
                                   widget="html"
                                   nolabel="1"
                                   placeholder="R√©digez ici votre feedback personnalis√©..."/>

                            <!-- Commentaire interne -->
                            <separator string="üí¨ Commentaire Interne (Optionnel)"/>
                            <field name="teacher_comment"
                                   widget="text"
                                   nolabel="1"
                                   placeholder="Note personnelle visible uniquement par les enseignants (optionnel)..."/>

                        </page>

                        <page string="üìã Templates" name="templates">
                            <div class="alert alert-light" role="status">
                                <h5>üìö Biblioth√®que de Templates</h5>
                                <p class="text-muted">
                                    Cliquez sur un template pour l'appliquer instantan√©ment
                                </p>
                            </div>

                            <div class="row">
                                <div class="col-md-6 mb-3">
                                    <div class="card border-success">
                                        <div class="card-header bg-success text-white">
                                            <strong>‚úÖ Excellente R√©ponse</strong>
                                        </div>
                                        <div class="card-body">
                                            <p class="card-text small text-muted">
                                                R√©ponse d√©montre une compr√©hension approfondie,
                                                tous les points cl√©s abord√©s avec pr√©cision.
                                            </p>
                                            <button string="Appliquer (Score: 95)"
                                                    type="object"
                                                    name="action_apply_template"
                                                    context="{'template_key': 'excellent'}"
                                                    class="btn btn-success btn-sm"/>
                                        </div>
                                    </div>
                                </div>

                                <div class="col-md-6 mb-3">
                                    <div class="card border-info">
                                        <div class="card-header bg-info text-white">
                                            <strong>üëç Bonne R√©ponse</strong>
                                        </div>
                                        <div class="card-body">
                                            <p class="card-text small text-muted">
                                                Compr√©hension correcte de l'essentiel,
                                                quelques d√©tails pourraient √™tre ajout√©s.
                                            </p>
                                            <button string="Appliquer (Score: 75)"
                                                    type="object"
                                                    name="action_apply_template"
                                                    context="{'template_key': 'good'}"
                                                    class="btn btn-info btn-sm"/>
                                        </div>
                                    </div>
                                </div>

                                <div class="col-md-6 mb-3">
                                    <div class="card border-warning">
                                        <div class="card-header bg-warning text-dark">
                                            <strong>‚ö†Ô∏è R√©ponse Incompl√®te</strong>
                                        </div>
                                        <div class="card-body">
                                            <p class="card-text small text-muted">
                                                Sur la bonne voie mais manque de d√©veloppement
                                                et d'arguments √©tay√©s.
                                            </p>
                                            <button string="Appliquer (Score: 50)"
                                                    type="object"
                                                    name="action_apply_template"
                                                    context="{'template_key': 'incomplete'}"
                                                    class="btn btn-warning btn-sm"/>
                                        </div>
                                    </div>
                                </div>

                                <div class="col-md-6 mb-3">
                                    <div class="card border-danger">
                                        <div class="card-header bg-danger text-white">
                                            <strong>‚ùå R√©ponse Incorrecte</strong>
                                        </div>
                                        <div class="card-body">
                                            <p class="card-text small text-muted">
                                                Erreurs importantes ou hors sujet,
                                                r√©vision du cours n√©cessaire.
                                            </p>
                                            <button string="Appliquer (Score: 20)"
                                                    type="object"
                                                    name="action_apply_template"
                                                    context="{'template_key': 'incorrect'}"
                                                    class="btn btn-danger btn-sm"/>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </page>
                    </notebook>

                    <!-- Options -->
                    <group>
                        <field name="notify_student"
                               widget="boolean_toggle"
                               string="Notifier l'√©tudiant par email"/>
                    </group>

                </sheet>

                <!-- Footer avec actions -->
                <footer>
                    <button name="action_validate_correction"
                            string="‚úÖ Valider et Enregistrer"
                            type="object"
                            class="btn-primary"
                            help="Enregistre la correction et notifie l'√©tudiant"/>

                    <button name="action_accept_suggestion"
                            string="‚úì Accepter la Suggestion"
                            type="object"
                            class="btn-success"
                            help="Accepte la suggestion automatique sans modification"/>

                    <button name="action_reject_answer"
                            string="‚úï Rejeter (Score 0)"
                            type="object"
                            class="btn-danger"
                            confirm="√ätes-vous s√ªr de vouloir rejeter cette r√©ponse ? Le score sera de 0."
                            help="Rejette la r√©ponse avec un score de 0"/>

                    <button string="Annuler"
                            class="btn-secondary"
                            special="cancel"/>

                    <button name="action_preview_feedback"
                            string="üëÅÔ∏è Pr√©visualiser"
                            type="object"
                            class="btn-link"
                            help="Pr√©visualise le feedback avant envoi"/>
                </footer>

            </form>
        </field>
    </record>

    <!-- ================================================================== -->
    <!-- WIZARD SIMPLIFI√â (Vue alternative rapide) -->
    <!-- ================================================================== -->
    <record id="view_correction_wizard_form_simple" model="ir.ui.view">
        <field name="name">slide.question.correction.wizard.form.simple</field>
        <field name="model">slide.question.correction.wizard</field>
        <field name="arch" type="xml">
            <form string="Correction Rapide">
                <group>
                    <field name="pending_answer_id" invisible="1"/>
                    <field name="student_name" readonly="1"/>
                    <field name="student_answer" readonly="1" widget="text"/>
                </group>
                <group>
                    <group>
                        <field name="final_score"/>
                    </group>
                    <group>
                        <field name="suggested_score" readonly="1" widget="progressbar"/>
                    </group>
                </group>
                <group>
                    <field name="use_suggested_feedback" widget="boolean_toggle"/>
                    <field name="final_feedback" widget="html"
                           invisible="use_suggested_feedback == False"/>
                    <field name="suggested_feedback" widget="html" readonly="1"
                           invisible="use_suggested_feedback == True"/>
                </group>
                <footer>
                    <button name="action_validate_correction"
                            string="Enregistrer"
                            type="object"
                            class="btn-primary"/>
                    <button string="Annuler"
                            class="btn-secondary"
                            special="cancel"/>
                </footer>
            </form>
        </field>
    </record>

</odoo>