<?xml version="1.0" encoding="utf-8"?>
<odoo>

    <!-- ================================================================== -->
    <!-- 1. VUE FORMULAIRE POUR SLIDE.CHANNEL (COURS) -->
    <!-- ================================================================== -->
    <record id="view_slide_channel_form_inherit_ai_fields" model="ir.ui.view">
        <field name="name">slide.channel.view.form.inherit.ai.fields</field>
        <field name="model">slide.channel</field>
        <field name="inherit_id" ref="website_slides.view_slide_channel_form"/>
        <field name="arch" type="xml">
            <!-- Ajout dans le notebook existant -->
            <xpath expr="//notebook" position="inside">
                <page string="Configuration IA" name="ai_config">
                    <group>
                        <p class="text-muted" colspan="2">
                            S√©lectionnez un fournisseur d'IA par d√©faut pour toutes les g√©n√©rations de contenu de ce
                            cours.
                        </p>
                        <field name="can_edit_ai_config" invisible="1"/>
                        <field name="ai_provider_config_id"
                               options="{'no_create': True}"
                               readonly="not can_edit_ai_config"/>
                    </group>
                </page>
            </xpath>
        </field>
    </record>

    <!-- ================================================================== -->
    <!-- 2. AJOUT DES BOUTONS DANS L'EN-T√äTE DU FORMULAIRE DU COURS -->
    <!-- ================================================================== -->
    <record id="slide_channel_view_form_add_buttons" model="ir.ui.view">
        <field name="name">slide.channel.view.form.add.buttons</field>
        <field name="model">slide.channel</field>
        <field name="inherit_id" ref="website_slides.view_slide_channel_form"/>
        <field name="arch" type="xml">
            <xpath expr="//header" position="inside">
                <!-- Bouton pour l'assistant de g√©n√©ration IA -->
                <button name="%(odoo_gpt_integration.action_launch_ai_main_wizard)d"
                        string="G√©n√©rer par IA"
                        type="action"
                        class="btn-primary"
                        help="Lancer l'assistant de g√©n√©ration de contenu par IA"/>

                <!-- Bouton pour ajouter une question manuellement -->
                <button name="%(odoo_gpt_integration.action_open_slide_question_wizard)d"
                        string="Ajouter Question"
                        type="action"
                        class="btn-secondary"
                        help="Ouvre un assistant pour cr√©er une nouvelle question dans un chapitre"/>
            </xpath>
        </field>
    </record>

    <!-- ================================================================== -->
    <!-- 3. VUE FORMULAIRE POUR SLIDE.SLIDE (CHAPITRE) - AVEC CONTEXTE RAG -->
    <!-- ================================================================== -->
    <record id="view_slide_slide_form_inherit_context" model="ir.ui.view">
        <field name="name">slide.slide.form.inherit.context</field>
        <field name="model">slide.slide</field>
        <field name="inherit_id" ref="website_slides.view_slide_slide_form"/>
        <field name="arch" type="xml">
            <!-- Ajout d'un onglet pour le contexte RAG -->
            <xpath expr="//notebook" position="inside">
                <page string="Contexte IA" name="ai_context">
                    <div class="alert alert-info" role="alert" invisible="x_ai_context_id == False">
                        <strong>‚úì Contexte RAG Actif</strong>
                        <p>Ce chapitre a √©t√© analys√© par l'IA et peut √™tre utilis√© pour g√©n√©rer du contenu.</p>
                        <p invisible="x_ai_context_is_expired == False">
                            <span class="text-danger">‚ö†Ô∏è Le contexte a expir√© et sera r√©g√©n√©r√© automatiquement si
                                n√©cessaire.
                            </span>
                        </p>
                    </div>

                    <group>
                        <group>
                            <field name="x_ai_context_id" readonly="1"/>
                            <field name="x_ai_context_file_id" readonly="1"/>
                        </group>
                        <group>
                            <field name="x_ai_context_expires_at" readonly="1"/>
                            <field name="x_ai_context_is_expired" readonly="1" invisible="1"/>
                        </group>
                    </group>

                    <div class="alert alert-warning" role="alert" invisible="x_ai_context_id != False">
                        <strong>‚ÑπÔ∏è Aucun Contexte</strong>
                        <p>Ce chapitre n'a pas encore √©t√© analys√© par l'IA.
                            Le contexte sera cr√©√© automatiquement lors de la premi√®re g√©n√©ration de contenu.
                        </p>
                    </div>

                    <group>
                        <button name="action_regenerate_context"
                                string="üîÑ R√©g√©n√©rer le Contexte"
                                type="object"
                                class="btn-warning"
                                help="Force la r√©g√©n√©ration du contexte RAG"/>
                    </group>
                </page>
            </xpath>
        </field>
    </record>

    <!-- ================================================================== -->
    <!-- 4. AJOUT DE BOUTONS D'ACTION RAPIDE SUR LE FORMULAIRE DE LA LE√áON -->
    <!-- ================================================================== -->
    <record id="view_slide_slide_form_inherit_ai_buttons" model="ir.ui.view">
        <field name="name">slide.slide.form.inherit.ai.buttons</field>
        <field name="model">slide.slide</field>
        <field name="inherit_id" ref="website_slides.view_slide_slide_form"/>
        <field name="arch" type="xml">
            <xpath expr="//div[hasclass('oe_button_box')]" position="inside">
                <button name="action_generate_summary"
                        string="G√©n√©rer R√©sum√©"
                        type="object"
                        class="oe_stat_button"
                        icon="fa-magic"
                        help="G√©n√©rer un r√©sum√© de cette le√ßon avec l'IA"
                        invisible="slide_category not in ['document', 'article', 'infographic']"/>
                <button name="action_generate_question_targeted"
                        string="G√©n√©rer Question"
                        type="object"
                        class="oe_stat_button"
                        icon="fa-question-circle"
                        help="G√©n√©rer une question cibl√©e sur cette le√ßon avec l'IA"
                        invisible="slide_category not in ['document', 'article', 'infographic']"/>
            </xpath>
        </field>
    </record>

</odoo>