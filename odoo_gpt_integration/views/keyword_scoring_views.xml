<?xml version="1.0" encoding="utf-8"?>
<odoo>

    <!-- ================================================================== -->
    <!-- VUES POUR LE SCORING DES MOTS-CL√âS -->
    <!-- ================================================================== -->

    <!-- Vue Liste -->
    <record id="view_keyword_scoring_tree" model="ir.ui.view">
        <field name="name">slide.question.keyword.score.tree</field>
        <field name="model">slide.question.keyword.score</field>
        <field name="arch" type="xml">
            <tree editable="bottom"
                  decoration-success="score_value &gt; 15"
                  decoration-info="score_value &gt; 0 and score_value &lt;= 15"
                  decoration-danger="score_value &lt; 0"
                  multi_edit="1">

                <field name="sequence" widget="handle"/>

                <field name="keyword"
                       placeholder="Ex: photosynth√®se"
                       required="1"/>

                <field name="score_value"
                       string="Score"
                       widget="integer"
                       required="1"/>

                <field name="keyword_type"
                       widget="badge"
                       decoration-success="keyword_type == 'required'"
                       decoration-info="keyword_type == 'bonus'"
                       decoration-danger="keyword_type == 'forbidden'"
                       optional="show"/>

                <field name="description"
                       placeholder="Note optionnelle"
                       optional="show"/>

                <!-- Actions rapides -->
                <button name="action_duplicate"
                        type="object"
                        icon="fa-files-o"
                        title="Dupliquer ce mot-cl√©"/>

                <button name="action_invert_score"
                        type="object"
                        icon="fa-exchange"
                        title="Inverser le score (positif ‚Üî n√©gatif)"/>

            </tree>
        </field>
    </record>

    <!-- Vue Formulaire -->
    <record id="view_keyword_scoring_form" model="ir.ui.view">
        <field name="name">slide.question.keyword.score.form</field>
        <field name="model">slide.question.keyword.score</field>
        <field name="arch" type="xml">
            <form string="Configuration Mot-cl√©">
                <sheet>
                    <div class="oe_title">
                        <h1>
                            <field name="keyword"
                                   placeholder="Ex: photosynth√®se"
                                   class="o_field_highlight"/>
                        </h1>
                        <div class="o_row">
                            <field name="keyword_type"
                                   widget="badge"
                                   readonly="1"/>
                        </div>
                    </div>

                    <group>
                        <group string="Configuration">
                            <field name="question_id" readonly="1"/>
                            <field name="sequence"/>
                            <field name="score_value"
                                   widget="integer"
                                   class="o_field_highlight"/>
                        </group>

                        <group string="Informations">
                            <field name="description"
                                   placeholder="Note pour l'enseignant..."/>
                        </group>
                    </group>

                    <!-- Guide d'utilisation -->
                    <notebook>
                        <page string="üí° Guide d'Utilisation">
                            <div class="alert alert-info" role="status">
                                <h5><i class="fa fa-info-circle me-2"></i>Comment d√©finir le score ?</h5>

                                <div class="row mt-3">
                                    <div class="col-md-6">
                                        <div class="card border-success mb-3">
                                            <div class="card-header bg-success text-white">
                                                <strong>Scores Positifs (Bonus)</strong>
                                            </div>
                                            <div class="card-body">
                                                <ul class="mb-0">
                                                    <li><strong>+20 √† +30 :</strong> Concepts essentiels, sans lesquels la r√©ponse est incompl√®te</li>
                                                    <li><strong>+10 √† +15 :</strong> √âl√©ments importants mais secondaires</li>
                                                    <li><strong>+5 √† +9 :</strong> D√©tails pertinents mais optionnels</li>
                                                </ul>
                                            </div>
                                        </div>
                                    </div>

                                    <div class="col-md-6">
                                        <div class="card border-danger mb-3">
                                            <div class="card-header bg-danger text-white">
                                                <strong>Scores N√©gatifs (P√©nalit√©s)</strong>
                                            </div>
                                            <div class="card-body">
                                                <ul class="mb-0">
                                                    <li><strong>-20 √† -30 :</strong> Erreurs graves ou confusions importantes</li>
                                                    <li><strong>-10 √† -15 :</strong> Termes inappropri√©s ou hors sujet</li>
                                                    <li><strong>-5 √† -9 :</strong> Impr√©cisions mineures</li>
                                                </ul>
                                            </div>
                                        </div>
                                    </div>
                                </div>

                                <h6 class="mt-3"><i class="fa fa-graduation-cap me-2"></i>Exemples Concrets</h6>
                                <div class="row">
                                    <div class="col-md-12">
                                        <table class="table table-sm table-bordered">
                                            <thead class="table-light">
                                                <tr>
                                                    <th>Mot-cl√©</th>
                                                    <th>Score</th>
                                                    <th>Justification</th>
                                                </tr>
                                            </thead>
                                            <tbody>
                                                <tr class="table-success">
                                                    <td><code>photosynth√®se</code></td>
                                                    <td><strong>+25</strong></td>
                                                    <td>Concept central, indispensable √† la r√©ponse</td>
                                                </tr>
                                                <tr class="table-success">
                                                    <td><code>chlorophylle</code></td>
                                                    <td><strong>+20</strong></td>
                                                    <td>√âl√©ment cl√© du processus</td>
                                                </tr>
                                                <tr class="table-info">
                                                    <td><code>glucose</code></td>
                                                    <td><strong>+15</strong></td>
                                                    <td>R√©sultat important mais pr√©visible</td>
                                                </tr>
                                                <tr class="table-info">
                                                    <td><code>lumi√®re</code></td>
                                                    <td><strong>+10</strong></td>
                                                    <td>Facteur important √† mentionner</td>
                                                </tr>
                                                <tr class="table-danger">
                                                    <td><code>respiration</code></td>
                                                    <td><strong>-20</strong></td>
                                                    <td>Confusion fr√©quente avec un autre processus</td>
                                                </tr>
                                                <tr class="table-danger">
                                                    <td><code>animal</code></td>
                                                    <td><strong>-15</strong></td>
                                                    <td>Hors contexte pour une question sur les plantes</td>
                                                </tr>
                                            </tbody>
                                        </table>
                                    </div>
                                </div>
                            </div>
                        </page>
                    </notebook>

                </sheet>
            </form>
        </field>
    </record>

    <!-- Vue Kanban (pour visualisation rapide) -->
    <record id="view_keyword_scoring_kanban" model="ir.ui.view">
        <field name="name">slide.question.keyword.score.kanban</field>
        <field name="model">slide.question.keyword.score</field>
        <field name="arch" type="xml">
            <kanban class="o_kanban_small_column"
                    default_group_by="keyword_type"
                    quick_create="false">

                <field name="keyword"/>
                <field name="score_value"/>
                <field name="keyword_type"/>
                <field name="description"/>

                <templates>
                    <t t-name="kanban-box">
                        <div class="oe_kanban_global_click"
                             t-attf-class="border-{{record.keyword_type.raw_value == 'required' ? 'success' : record.keyword_type.raw_value == 'forbidden' ? 'danger' : 'info'}}">

                            <div class="o_kanban_record_top">
                                <div class="o_kanban_record_headings">
                                    <strong class="o_kanban_record_title">
                                        <field name="keyword"/>
                                    </strong>
                                </div>
                                <div class="o_kanban_record_top_right">
                                    <span class="badge"
                                          t-attf-class="bg-{{record.score_value.raw_value > 0 ? 'success' : 'danger'}}"
                                          style="font-size: 1.2em;">
                                        <t t-if="record.score_value.raw_value > 0">+</t>
                                        <t t-esc="record.score_value.raw_value"/>
                                    </span>
                                </div>
                            </div>

                            <div class="o_kanban_record_body" t-if="record.description.raw_value">
                                <div class="text-muted small">
                                    <i class="fa fa-comment-o me-1" title="Commentaire" role="img" aria-label="Commentaire"></i>
                                    <field name="description"/>
                                </div>
                            </div>

                        </div>
                    </t>
                </templates>
            </kanban>
        </field>
    </record>

    <!-- Action -->
    <record id="action_keyword_scoring" model="ir.actions.act_window">
        <field name="name">Scoring Mots-cl√©s</field>
        <field name="res_model">slide.question.keyword.score</field>
        <field name="view_mode">tree,kanban,form</field>
        <field name="help" type="html">
            <p class="o_view_nocontent_smiling_face">
                Configurez les mots-cl√©s et leur scoring
            </p>
            <p>
                D√©finissez les mots-cl√©s attendus (scores positifs)
                et les mots-cl√©s √† √©viter (scores n√©gatifs).
            </p>
        </field>
    </record>

</odoo>